<style>
  #container {
    height: 100%;
    padding: 8px;
  }
  #content {
    padding: 5px;
  }
</style>

<div class="columns" id="container">
  <div class="column is-10 is-offset-1">
    <!-- 面板 -->
    <nav class="panel">
      <!-- 内容 -->
      <div id="content">
        <div class="tile is-ancestor">
          <div class="tile is-vertical is-8">
            <div class="tile">
              <div class="tile is-parent">
                <article class="tile is-child notification">
                  <p class="title" id="symbol_title"></p>
                  <p class="subtitle">
                    some description about the stock and the Chart
                  </p>
                  <div>
                    <nav class="panel">
                      <canvas id="myChart"></canvas>
                    </nav>
                  </div>
                </article>
              </div>
            </div>
          </div>
          <div class="tile is-parent">
            <article class="tile is-child notification is-success">
              <div class="content">
                <p class="title" id="symbol_name"></p>
                <p class="subtitle" id="symbol_ipo"></p>
                <img
                  src="https://bulma.io/images/placeholders/640x480.png"
                  id="symbol_logo"
                />
                <p class="subtitle" id="symbol_country"></p>

                <div class="content">
                  <!-- Content -->
                </div>
              </div>
            </article>
          </div>
        </div>
      </div>
    </nav>
  </div>
</div>

<script>
  //
  // chart code
  //
  var ctx = document.getElementById("myChart").getContext("2d");
  var myChart = new Chart(ctx, {
    type: "line",
    backgroundColor: "rgb(255, 99, 132)",
    data: {
      datasets: [
        {
          type: "line",
          label: "price",
          backgroundColor: "red",
          borderColor: "red",
          data: [],
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      scales: {
        xAxes: {
          type: "timeseries",
          display: true,
        },
        yAxes: {
          beginAtZero: false,
        },
      },
    },
  });

  //
  // basic information about the stock company
  //

  // standard symbol
  var text = "BINANCE:BTCUSDT";

  // the title of the company
  var obj = document.getElementById("symbol_title");
  obj.innerHTML = text;

  //
  // stock company profile
  //

  async function stockProfile(symbol) {
    const response = await fetch(
      "https://finnhub.io/api/v1/stock/profile2?symbol=" +
        symbol +
        "&token=c0ro5sv48v6voi2d8ndg"
    );
    let data = await response.json();
    //name
    var sym_name = data.name;
    var profile_name = document.getElementById("symbol_name");
    profile_name.innerHTML = "Stock Name:<br><strong>" + sym_name + "<strong>";
    //ipo
    var sym_ipo = data.ipo;
    var profile_ipo = document.getElementById("symbol_ipo");
    profile_ipo.innerHTML = "Stock IPO Date:<br>" + sym_ipo;
    //logo
    var sym_logo = data.logo;
    var profile_logo = document.getElementById("symbol_logo");
    profile_logo.src = sym_logo;
    //country
    var sym_country = data.country;
    var profile_country = document.getElementById("symbol_country");
    profile_country.innerHTML = "Country:<br>" + sym_country;

    // console.log(data);
  }

  // stockProfile("BINANCE:BTCUSDT");
  stockProfile("AAPL");

  //
  // websocket code
  //
  let wSocket;

  if (wSocket) {
    wSocket.close();
  }
  wSocket = new WebSocket("wss://ws.finnhub.io?token=c0ro5sv48v6voi2d8ndg");
  wSocket.onopen = function () {
    wSocket.send(`{"type":"subscribe","symbol":"${text}"}`);
  };

  wSocket.onmessage = function (event) {
    if (event.type == "message" && JSON.parse(event.data).data) {
      let d = JSON.parse(event.data).data[0];
      if (d) {
        // console.log(d);
        let volumeData = myChart.data.datasets[0].data;
        volumeData.push({ x: d.t, y: d.p });
        myChart.update();
      }
    }
  };

  /*
  s Symbol.
  p Last price.
  t UNIX milliseconds timestamp.
  v Volume.
  c List of trade conditions.
  */

  //
  // candlestick chart
  //
</script>
